package cc.slack.features.modules.impl.exploit.norotate.impl;

import cc.slack.events.impl.network.PacketEvent;
import cc.slack.events.impl.player.UpdateEvent;
import cc.slack.events.impl.player.WorldEvent;
import cc.slack.features.modules.impl.exploit.norotate.INorotate;
import io.github.nevalackin.radbus.Listen;
import net.minecraft.network.Packet;
import net.minecraft.network.play.client.C03PacketPlayer;
import net.minecraft.network.play.server.S08PacketPlayerPosLook;

/**
 * @author nyoxy
 * @since 10/22/2024
 */
public final class PacketNoRotate implements INorotate {

    private float yaw, pitch;
    private boolean teleport;

    @Override
    public void onDisable() {
    }

    @Listen
    public void onWorld(WorldEvent event) {
    }

    @Listen
    public void onUpdate(UpdateEvent event) {

    }

    @Listen
    public void onPacket(PacketEvent event) {
        final Packet packet = event.getPacket();

        if(packet instanceof S08PacketPlayerPosLook) {
            final S08PacketPlayerPosLook s08PacketPlayerPosLook = (S08PacketPlayerPosLook) packet;
            this.yaw = s08PacketPlayerPosLook.getYaw();
            this.pitch = s08PacketPlayerPosLook.getPitch();

            s08PacketPlayerPosLook.pitch = mc.thePlayer.rotationPitch;
            s08PacketPlayerPosLook.yaw = mc.thePlayer.rotationYaw;

            this.teleport = true;
        }

        if (this.teleport && packet instanceof C03PacketPlayer.C06PacketPlayerPosLook) {
            final C03PacketPlayer.C06PacketPlayerPosLook p = (C03PacketPlayer.C06PacketPlayerPosLook) packet;
            p.yaw = this.yaw;
            p.pitch = this.pitch;
            event.setPacket(p);
            this.teleport = false;
        }
    }

    @Override
    public String toString() {
        return "Packet";
    }
}