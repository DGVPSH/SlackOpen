// Slack Client (discord.gg/slackclient)

package cc.slack.features.modules.impl.exploit.disablers.verus;

import cc.slack.events.impl.network.PacketEvent;
import cc.slack.events.impl.player.UpdateEvent;
import cc.slack.features.modules.impl.exploit.disablers.IDisabler;
import cc.slack.utils.network.PacketUtil;
import net.minecraft.network.Packet;
import net.minecraft.network.play.client.C00PacketKeepAlive;
import net.minecraft.network.play.client.C0FPacketConfirmTransaction;
import net.minecraft.network.play.server.S37PacketStatistics;

public class OldVerusCombatDisabler implements IDisabler {


    int transactions = 0;
    short newTransaction = 0;

    @Override
    public void onEnable() {
        transactions = 0;
        newTransaction = 0;
    }

    @Override
    public void onUpdate(UpdateEvent event) {
        if (mc.thePlayer.ticksExisted % 600 == 0) {
            PacketUtil.send(new C00PacketKeepAlive());
        }
    }

    @Override
    public void onPacket(PacketEvent event) {
        final Packet packet = event.getPacket();
        if (packet instanceof C00PacketKeepAlive) {
            event.cancel();
        }
        if (packet instanceof C0FPacketConfirmTransaction) {
            transactions++;
            if (transactions <= 1) {
                newTransaction = ((C0FPacketConfirmTransaction) packet).getUid();
            }
            ((C0FPacketConfirmTransaction) packet).uid = newTransaction;
        }

        if (packet instanceof S37PacketStatistics) {
            transactions = 0;
        }
    }

    @Override
    public String toString() {
        return "Old Verus Combat";
    }
}
